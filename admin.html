<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Clientes</title>
    <!-- Carregando o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #d1d5db; /* text-gray-300 */
        }
        /* Esconde a barra de rolagem */
        ::-webkit-scrollbar {
            display: none;
        }
        /* Estilo da Tabela */
        thead th {
            background-color: #374151; /* bg-gray-700 */
            color: #e5e7eb; /* text-gray-200 */
            padding: 12px 16px;
            text-align: left;
            text-transform: uppercase;
            font-size: 0.75rem; /* text-xs */
            letter-spacing: 0.05em;
        }
        tbody tr:nth-child(odd) {
            background-color: #1f2937; /* bg-gray-800 */
        }
        tbody tr:nth-child(even) {
            background-color: #2b3646; /* Um pouco mais claro que 800 */
        }
        tbody td {
            padding: 12px 16px;
            border-bottom: 1px solid #374151; /* border-gray-700 */
        }
        tbody tr:hover {
            background-color: #4b5563; /* bg-gray-600 */
        }
    </style>
</head>
<body class="antialiased">

    <main class="container mx-auto p-4 md:p-8">
        
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">
                <span class="text-3xl">⚽</span> Painel de Clientes (Fut Ao Vivo)
            </h1>
            <p class="text-lg text-gray-400">
                Lista de usuários cadastrados para assistir aos jogos. Os dados são atualizados em tempo real.
            </p>
        </header>

        <!-- Tabela de Clientes -->
        <div class="w-full overflow-hidden rounded-xl shadow-2xl border border-gray-700">
            <table class="w-full min-w-full">
                <!-- Cabeçalho da Tabela -->
                <thead>
                    <tr>
                        <th class="w-1/3">Nome Completo</th>
                        <th class="w-1/3">WhatsApp</th>
                        <th class="w-1/3">Data de Cadastro</th>
                    </tr>
                </thead>
                <!-- Corpo da Tabela (será preenchido pelo JS) -->
                <tbody id="clientes-table-body">
                    <!-- Linha de Carregamento Inicial -->
                    <tr id="loading-row">
                        <td colspan="3" class="text-center text-gray-500 py-8">
                            Conectando ao banco de dados...
                        </td>
                    </tr>
                    <!-- Linha de Erro (escondida) -->
                    <tr id="error-row" class="hidden">
                        <td colspan="3" class="text-center text-red-400 font-medium py-8">
                            Erro: Não foi possível carregar os dados. Verifique a configuração do Firebase.
                        </td>
                    </tr>
                    <!-- Linha de "Nenhum Cliente" (escondida) -->
                     <tr id="no-clients-row" class="hidden">
                        <td colspan="3" class="text-center text-gray-500 py-8">
                            Nenhum cliente cadastrado ainda.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </main>

    <!-- 
      ==========================================================================
      == JAVASCRIPT
      ==========================================================================
    -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        
        // ==============================================================================
        // == IMPORTANTE: COLE A SUA CONFIGURAÇÃO DO FIREBASE AQUI ==
        // ==============================================================================
        // DEVE SER O MESMO OBJETO `firebaseConfig` QUE VOCÊ USOU NO `index.html`.
        const firebaseConfig = {
          apiKey: "AIzaSyB8CRcynG97ZLVf24wt9ylbs2kemYk6oSU",
  authDomain: "barbercontrol-6b1f1.firebaseapp.com",
  projectId: "barbercontrol-6b1f1",
  storageBucket: "barbercontrol-6b1f1.firebasestorage.app",
  messagingSenderId: "984412023617",
  appId: "1:984412023617:web:1b10bf21e1ec3a63bf0fc0",
  measurementId: "G-JR9PJSCHWG"
        };
        // ==============================================================================
        // ==============================================================================


        let app, db, auth;
        let clientesCollection;
        // Caminho da coleção (simplificado para 'clientes')
        const clientesCollectionPath = `clientes`; 

        // --- Elementos da UI ---
        const tableBody = document.getElementById('clientes-table-body');
        const loadingRow = document.getElementById('loading-row');
        const errorRow = document.getElementById('error-row');
        const noClientsRow = document.getElementById('no-clients-row');
        // --- Fim Elementos da UI ---

        
        // Função para formatar a data
        function formatFirebaseTimestamp(timestamp) {
            if (!timestamp) return 'Data indisponível';
            // Converte o Timestamp do Firebase para um Date do JS
            const date = timestamp.toDate(); 
            // Formata para o padrão brasileiro (dd/mm/aaaa, hh:mm)
            return date.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }


        // Função para inicializar, autenticar e ouvir os dados
        async function initializeAndListen() {
            try {
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey.includes("COLE-AQUI")) {
                    loadingRow.classList.add('hidden');
                    errorRow.classList.remove('hidden');
                    errorRow.querySelector('td').textContent = "Erro: A chave do Firebase não foi configurada.";
                    console.error("Configuração do Firebase não foi preenchida.");
                    return; // Para a execução
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug');
                clientesCollection = collection(db, clientesCollectionPath);

                // Tenta autenticar (anônimo)
                await new Promise((resolve, reject) => {
                    const unsubscribe = onAuthStateChanged(auth, async (user) => {
                        unsubscribe();
                        if (user) {
                            resolve(user);
                        } else {
                            try {
                                await signInAnonymously(auth);
                                resolve(auth.currentUser);
                            } catch (authError) {
                                reject(authError);
                            }
                        }
                    });
                });

                console.log("Autenticado! Ouvindo a coleção 'clientes'...");

                // Ouve a coleção 'clientes' em tempo real
                onSnapshot(clientesCollection, (snapshot) => {
                    loadingRow.classList.add('hidden'); // Esconde o "Carregando"
                    tableBody.innerHTML = ''; // Limpa a tabela antes de adicionar novos dados

                    if (snapshot.empty) {
                        // Se não houver dados, mostra a linha "Nenhum cliente"
                        tableBody.appendChild(noClientsRow);
                        noClientsRow.classList.remove('hidden');
                        return;
                    }

                    // Se houver dados, processa e exibe
                    noClientsRow.classList.add('hidden'); // Garante que a linha "nenhum" está escondida
                    
                    snapshot.docs.forEach(doc => {
                        const cliente = doc.data();
                        
                        // Cria uma nova linha na tabela
                        const tr = document.createElement('tr');
                        
                        // Adiciona as células (nome, whatsapp, data)
                        tr.innerHTML = `
                            <td>${cliente.nome || 'N/A'}</td>
                            <td>${cliente.whatsapp || 'N/A'}</td>
                            <td>${formatFirebaseTimestamp(cliente.dataCadastro)}</td>
                        `;
                        
                        // Adiciona a linha ao corpo da tabela
                        tableBody.appendChild(tr);
                    });

                }, (error) => {
                    // Se der erro ao ouvir os dados
                    console.error("Erro ao ouvir a coleção:", error);
                    tableBody.innerHTML = ''; // Limpa a tabela
                    tableBody.appendChild(errorRow); // Mostra a linha de erro
                    loadingRow.classList.add('hidden');
                    errorRow.classList.remove('hidden');
                });

            } catch (error) {
                // Se der erro na inicialização ou autenticação
                console.error("Erro fatal na inicialização:", error);
                tableBody.innerHTML = ''; // Limpa a tabela
                tableBody.appendChild(errorRow); // Mostra a linha de erro
                loadingRow.classList.add('hidden');
                errorRow.classList.remove('hidden');
            }
        }

        // Inicia tudo
        initializeAndListen();

    </script>

</body>
</html>
